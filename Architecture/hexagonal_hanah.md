### 계층형 아키텍처의 문제점
<img width=500 src='https://user-images.githubusercontent.com/62924471/215233642-5546c44f-5b4c-4901-9643-b853daffbc98.png'>
- 웹 계층은 도메인 계층을 의존하고, 도메인 계층은 영속성 계층을 의존하기 때문에 도메인 계층 입장에서 의존성이 비대칭적입니다.
    - DIP(의존 역전 원칙 : 객체는 저수준 모듈보다 고수준 모듈에 의존해야 한다는 원칙)를 적용해도 한계가 발생한다.
- 프로그램의 아키텍처가 데이터베이스에 의존하게 된다.
    - 도메인이 인프라(데이터베이스)에 의존하게 되면서 도메인 적인 관심사와 기술적인 관심사가 섞이게 된다.

## 헥사고날 아키텍처란?

- **도메인 중심 아키텍처** 일종으로 클린 아키텍처를 일반화한 구조 중 하나이다.
    - 데이터베이스가 아닌 **비즈니스 로직의 도메인**을 기준으로 서비스를 설계한다.(**DDD**)
- UI나 database를 비즈니스 로직으로 분리되어야하는 외부요소로 취급한다.
- 비즈니스 로직을 다루는 내부(도메인)와 기술적인 것을 다루는 외부(인프라)로 분해될 수 있다.
    - **내부 영역** - 순수한 비즈니스 로직을 표현하며 캡슐화된 영역이고 기능적 요구사항에 따라 먼저 설계
    - **외부 영역** - 내부 영역에서 기술을 분리하여 구성한 영역이고 내부 영역 설계 이후 설계

### **구조**
<img width=500 src='https://user-images.githubusercontent.com/62924471/215233658-80f3c5ea-c514-4aab-bff5-91f5a04d2191.png'>
<img width=500 src='https://user-images.githubusercontent.com/62924471/215233674-395addda-693a-4eb8-8905-6792d91d8648.png'>

### 포트와 어댑터

- **포트와 어댑터 아키텍처**(패턴) 라고도 부릅니다.
- **외부에 포함된 컴포넌트를 어댑터(adapter)** 라 부르고, **어댑터가 내부와 상호 작용하는 부분을 포트(port)** 라 부른다.
- **어댑터** : 외부 세계와 포트 간 교환을 조정
    - 인바운드(Inbound)/아웃바운드(Outbound) 어댑터
    - **인바운드 어댑터** - 외부 애플리케이션/서비스와 내부 비즈니스 영역(인바운드 포트) 간 데이터 교환을 조정
        - driving adapter (= incoming adapter)
        - 주도하는 어댑터
        - 웹 어댑터, 외부 시스템 어댑터
        - 애플리케이션 코어를 호출합니다.
    - **아웃바운드 어댑터** - 내부 비즈니스 영역(아웃바운드 포트)과 외부 애플리케이션/서비스 간 데이터 교환을 조정
        - driven adapter (= outgoing adapter)
        - 애플리케이션 코어에 의해 호출됩니다.
        - 주도되는 어댑터
        - 영속성 어댑터, 외부 시스템 어댑터
- **포트** : 내부 비즈니스 영역을 외부 영역에 노출한 API
    - 인바운드(Inbound)/아웃바운드(Outbound) 포트
    - **인바운드 포트** - 내부 영역 사용을 위해 노출된 API, incoming adapter에 의해 불려진다.
    - **아웃바운드 포트** - 내부 영역이 외부 영역을 사용하기 위한 API, outgoing adapter를 부른다.

### 아키텍쳐 계층 구조

- 어댑터
    - 가장 바깥쪽에 있는 계층으로 애플리케이션과 다른 시스템 간의 상호작용을 한다.
    - web 어댑터(= 웹 컨트롤러), persistence 어댑터 등이 위치함
- 애플리케이션 코어/애플리케이션 계층
    - 바깥 계층에서 호출하기 위해 반드시 거쳐야 하는 곳이다.
    - 포트와 서비스를 포함합니다
        - 포트
            - 인터페이스로 구성
            - 애플리케이션 코어와 어댑터 간에 통신을 위한 부분
            - 서비스에서 구현
        - 서비스
            - 포트 구현체(= 유스케이스 구현체)
    - 외부로 향하는 의존성이 없습니다.(= 모든 의존성은 코어를 향합니다.)
- 도메인 계층
    - 도메인 엔티티

### **헥사고날 아키텍처의 장점**

- 아키텍처 확장이 용이하다.
- SOLID 원칙을 쉽게 적용할 수 있다.
- 모듈 일부를 배포하는 게 용이하다.
- 테스트를 위해 모듈을 가짜로 바꿀 수 있으므로 테스트가 더 안정적이고 쉽다.
    
  - 비즈니스 로직 유닛 테스트
    
    - 기존 계층형 아키텍처에서는 영속성 계층을 모킹하기 위해 서비스 테스트에서 repository를 모킹하고 entity를 반환하는 로직을 구현해야 했다.
    - 이와 다르게 헥사고날 아키텍처에서는 오직 비즈니스 모델만을 테스트 할 수 있다.
    - 인커밍 어댑터, 아웃고잉 어댑터 모두 비즈니스 모델을 반환하고 입력으로 전달한다.
- 더 큰 비즈니스적 가치를 갖고 더 오래 지속되는 도메인 모델에 큰 관심을 갖게 된다.

### 헥사고날 아키텍처의 단점

- 계층형 아키텍처에 비해 많은 컨버팅과 어댑터가 있고 간단한 프로젝트에선 생산성이 떨어질 수 밖에 없다. (이하 예시)
    1. 웹 계층
        1. request를 command로 컨버팅 
        2. command 를 domain model로 컨버팅 
    2. 도메인 서비스 
        1. domain model을 entity로 컨버팅
    3. 영속성 계층
        1. entity를 model로 컨버팅
        2. model을 response로 컨버팅
    4. 웹계층
